<div class="container-fluid">
  <!-- Tiêu đề -->
  <div class="row">
    <div class="col-md-12">
      <h1 class="display-4">Welcome to ProsperPath!</h1>
      <p class="lead">Your personal finance management dashboard</p>
    </div>
  </div>

  <!-- Nội dung chính: Dashboard hoặc thông tin đăng nhập -->
  <div class="row">
    @if (account() !== null) {
      <!-- Dashboard khi đã đăng nhập -->
      <div class="col-md-12">
        <div class="alert alert-success">
          @if (account(); as accountRef) {
            <span id="home-logged-message" jhiTranslate="home.logged.message" [translateValues]="{ username: accountRef.login }"
              >You are logged in as user "{{ accountRef.login }}".</span
            >
          }
        </div>

        <!-- Hiển thị thông báo lỗi nếu có -->
        @if (errorMessage()) {
          <div class="alert alert-danger">
            {{ errorMessage() }}
          </div>
        }

        <!-- Bộ lọc khoảng thời gian -->
        <div class="mb-3">
          <label for="periodSelect">Select period:</label>
          <select id="periodSelect" class="form-control" [(ngModel)]="selectedPeriod" (change)="onPeriodChange()">
            <option value="week">This Week</option>
            <option value="month">This Month</option>
            <option value="year">This Year</option>
          </select>
        </div>

        <!-- Add reusable card template with cardClass -->
        <ng-template
          #cardTemplate
          let-title="title"
          let-icon="icon"
          let-value="value"
          let-percentage="percentage"
          let-period="period"
          let-headerClass="headerClass"
          let-cardClass="cardClass"
        >
          <div class="card mb-3" [ngClass]="cardClass" style="border-radius: 15px">
            <div class="card-header" [ngClass]="headerClass">
              <strong>{{ title }}</strong>
              <i class="bi" [ngClass]="icon + ' float-end'"></i>
            </div>
            <div class="card-body">
              <h5 class="card-title fw-bold">{{ value | currency: 'VND' }}</h5>
              <span
                class="badge"
                [ngStyle]="
                  percentage < 0
                    ? { color: '#dc3545', 'background-color': 'rgba(220,53,69,0.1)', 'border-radius': '12px' }
                    : { color: '#28a745', 'background-color': 'rgba(40,167,69,0.1)', 'border-radius': '12px' }
                "
              >
                <i class="bi bi-arrow-{{ percentage < 0 ? 'down' : 'up' }}"></i> {{ percentage }}%
              </span>
              <small class="text-muted">{{ period }}</small>
            </div>
          </div>
        </ng-template>

        <!-- Replace card blocks with updated contexts -->
        <div class="row">
          <!-- Total Assets Card (full card primary) -->
          <div class="col-md-3">
            <ng-container
              *ngTemplateOutlet="
                cardTemplate;
                context: {
                  title: 'Total Assets',
                  icon: 'bi-wallet',
                  value: totalAssets(),
                  percentage: assetsChangePercentage(),
                  period: selectedPeriod(),
                  cardClass: 'bg-primary text-white',
                }
              "
            >
            </ng-container>
          </div>

          <!-- Total Income Card -->
          <div class="col-md-3">
            <ng-container
              *ngTemplateOutlet="
                cardTemplate;
                context: {
                  title: 'Total Income',
                  icon: 'bi-cash-stack',
                  value: totalIncome(),
                  percentage: incomeChangePercentage(),
                  period: selectedPeriod(),
                  headerClass: 'text-dark',
                }
              "
            >
            </ng-container>
          </div>

          <!-- Total Expense Card -->
          <div class="col-md-3">
            <ng-container
              *ngTemplateOutlet="
                cardTemplate;
                context: {
                  title: 'Total Expense',
                  icon: 'bi-credit-card',
                  value: totalExpense(),
                  percentage: expenseChangePercentage(),
                  period: selectedPeriod(),
                  headerClass: 'text-dark',
                }
              "
            >
            </ng-container>
          </div>

          <!-- Profit/Loss Card -->
          <div class="col-md-3">
            <ng-container
              *ngTemplateOutlet="
                cardTemplate;
                context: {
                  title: 'Profit/Loss',
                  icon: 'bi-graph-up',
                  value: totalProfit(),
                  percentage: profitChangePercentage(),
                  period: selectedPeriod(),
                  headerClass: 'text-dark',
                }
              "
            >
            </ng-container>
          </div>
        </div>
      </div>
    } @else {
      <!-- Thông tin khi chưa đăng nhập -->
      <div class="col-md-12">
        <div class="alert alert-warning">
          <span jhiTranslate="global.messages.info.authenticated.prefix">If you want to </span>
          <a class="alert-link" (click)="login()" jhiTranslate="global.messages.info.authenticated.link">sign in</a
          ><span jhiTranslate="global.messages.info.authenticated.suffix"
            >, you can try the default accounts:<br />- Administrator (login="admin" and password="admin") <br />- User (login="user" and
            password="user").</span
          >
        </div>

        <div class="alert alert-warning">
          <span jhiTranslate="global.messages.info.register.noaccount">You don't have an account yet?</span> 
          <a class="alert-link" routerLink="/account/register" jhiTranslate="global.messages.info.register.link">Register a new account</a>
        </div>
      </div>
    }
  </div>
</div>
